package kevin.module.modules.exploit;

import io.netty.buffer.Unpooled;
import kevin.event.EventTarget;
import kevin.event.PacketEvent;
import kevin.module.ClientModule;
import kevin.module.ListValue;
import kevin.module.ModuleCategory;
import kevin.utils.PacketUtils;
import net.minecraft.network.PacketBuffer;
import net.minecraft.network.play.client.C17PacketCustomPayload;
import org.jetbrains.annotations.NotNull;

public class ClientSpoof extends ClientModule {
    @NotNull
    public static final ClientSpoof INSTANCE = new ClientSpoof();
    @NotNull
    private static final ListValue mode = new ListValue("Mode", new String[]{"Lunar", "Forge", "LabyMod", "PVP-L", "C-B", "Geyser"}, "Lunar");

    private ClientSpoof() {
        super("ClientSpoof", "Let the server think you are using another client.", ModuleCategory.EXPLOIT);
    }

    @EventTarget
    public final void onPacket(@NotNull PacketEvent event) {
        if (event.getPacket() instanceof C17PacketCustomPayload p
                &&
                p.getChannelName().equalsIgnoreCase("mc|brand")
        ) {
            C17PacketCustomPayload packet = null;
            label38:
            {
                switch (mode.get()) {
                    case "C-B":
                        packet = new C17PacketCustomPayload("MC|Brand", (new PacketBuffer(Unpooled.buffer())).writeString("CB"));
                        break label38;
                    case "Forge":
                        packet = new C17PacketCustomPayload("MC|Brand", (new PacketBuffer(Unpooled.buffer())).writeString("FML"));
                        break label38;
                    case "Lunar":
                        packet = new C17PacketCustomPayload("REGISTER", (new PacketBuffer(Unpooled.buffer())).writeString("Lunar-Client"));
                        break label38;
                    case "PVP-L":
                        packet = new C17PacketCustomPayload("MC|Brand", (new PacketBuffer(Unpooled.buffer())).writeString("if ("));
                        break label38;
                    case "LabyMod":
                        packet = new C17PacketCustomPayload("MC|Brand", (new PacketBuffer(Unpooled.buffer())).writeString("LMC"));
                        break label38;
                    case "Geyser":
                        packet = new C17PacketCustomPayload("MC|Brand", (new PacketBuffer(Unpooled.buffer())).writeString("Geyser"));
                        break label38;
                }

            }

            if (packet != null) {
                event.cancelEvent();
                PacketUtils.sendPacketNoEvent(packet);
            }
        }

    }

    @NotNull
    public String getTag() {
        return mode.get();
    }
}
